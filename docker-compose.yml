version: '3'

services:

  msgqueue:
    build: ./msgqueue

  ipac-poll-and-pull-service:
    build: ./imcheck
    depends_on:
        - "msgqueue"
        - "db"
        - "nersc-job-submission-service"

  nersc-queue-monitor-service:
    build: ./queuemon
    depends_on:
        - "msgqueue"
        - "db"
        - "nersc-job-submission-service"

  nersc-job-submission-service:
    build: ./pipeline
    depends_on:
        - "msgqueue"
        - "db"
    volumes:
        - ./pipeline/msgconsumer:/daemon
        - ./pipeline:/pipeline

  db:
    build: ./q3cpsql
    command: [postgres, -c, 'log_statement=all']
